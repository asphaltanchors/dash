# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Structure

This is a Next.js 15 application using the App Router with TypeScript and Tailwind CSS. The project consumes data from a DBT pipeline via Drizzle ORM with PostgreSQL.

**Key Stack:**
- Next.js 15 (App Router - ALWAYS use App Router)
- React 19
- TypeScript 5
- Tailwind CSS 4
- Drizzle ORM + PostgreSQL (read-only, schema follows DBT pipeline)
- ESLint with Next.js config

**Directory Structure:**
- `app/` - Next.js App Router pages and layouts
- `drizzle/` - Database migrations (generated by Drizzle)
- Database schema expected at `src/db/schema.ts` (configured in drizzle.config.ts)

**Architecture Principles:**
- App will become very complex with many pages - establish and follow consistent patterns
- Always use Next.js 15 App Router (never Pages Router)
- Use Server Actions instead of API routes when possible
- Leverage latest Next.js 15 features
- App runs behind Tailscale (no public internet access concerns)

## Common Commands

**Development:**
```bash
npm run dev          # Start development server with Turbopack
npm run build        # Build for production
npm run start        # Start production server
npm run lint         # Run ESLint
```

**Database (Drizzle):**
```bash
npx drizzle-kit pull        # Pull schema from analytics_mart (configured default)
npx drizzle-kit generate    # Generate migrations
npx drizzle-kit migrate     # Run migrations
npx drizzle-kit studio      # Open Drizzle Studio
```

## Configuration

- **Database:** PostgreSQL connection via `DATABASE_URL` environment variable
- **Path alias:** `@/*` maps to project root
- **Fonts:** Uses Geist Sans and Geist Mono fonts
- **Styling:** Tailwind CSS with custom CSS variables

## Database Schema

**IMPORTANT:** This app consumes data from a DBT pipeline. DO NOT create or modify database schema - it must follow what's provided by the DBT pipeline. The schema in `src/db/schema.ts` should reflect the existing DBT tables and views, not define new ones.

- Database schema at `src/db/schema.ts` mirrors DBT pipeline output
- Uses PostgreSQL dialect
- Read-only access pattern - no schema modifications
- Use Drizzle to query existing DBT tables/views
- **Primary focus:** `analytics_mart` schema (configured as default in drizzle.config.ts)

**Available Analytics Mart Tables:**
- `fct_orders` - Order fact table (38 columns: order details, customer info, financial data)
- `fct_products` - Product fact table

**Key Data Points from fct_orders:**
- Order lifecycle: order_date, due_date, ship_date, status, is_paid
- Customer: customer, billing/shipping addresses
- Financial: total_amount, total_tax, total_line_items_amount, effective_tax_rate
- Operations: payment_method, shipping_method, sales_rep, currency

## MCP Database Access

An MCP (Model Context Protocol) connector is configured for direct database querying:
- Configuration: `.claude_mcp_config.json` (excluded from git)
- Database: `postgresql://dqi:dqi@localhost:5432/dqi`
- Use MCP tools to explore DBT pipeline tables and understand data structure
- Query the database directly to inform schema definitions and data access patterns

## Development Patterns

**Consistent Patterns to Follow:**
- Use Server Components by default, Client Components only when needed ('use client')
- Prefer Server Actions over API routes for mutations
- Use Next.js 15 features: React.cache(), unstable_cache(), etc.
- File-based routing in `app/` directory
- Co-locate related components, actions, and types in route directories
- Use TypeScript strictly - no `any` types